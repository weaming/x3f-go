#!/bin/bash
# ln -sf $PWD/hooks/pre-commit .git/hooks/pre-commit

# 获取所有暂存的 .go 文件
STAGED_GO_FILES=$(git diff --cached --name-only --diff-filter=ACM | grep '\.go$')

if [ -z "$STAGED_GO_FILES" ]; then
    echo 'No go files to format.'
    exit 0
fi

echo "Running go fmt on staged Go files..."

# 对每个文件执行 go fmt
for file in $STAGED_GO_FILES; do
    if [ -f "$file" ]; then
        echo "  Formatting: $file"
        go fmt "$file"
        # 将格式化后的文件重新添加到暂存区
        git add "$file"
    fi
done

echo "✓ Go fmt complete"
exit 0
